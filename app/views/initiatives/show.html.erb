<% if permitted_to? :update, :initiatives %>
  <%= modal_window id: 'signs-activation-confirmation' do %>
    <div class="modal-header signHeader">
    	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    	<h5 class="modal-title signTitle"><i class="icon-pencil"></i>Activar Firmas</h5>
    </div>
    <div class="modal-body">
      <p>Se creará un botón "Firmar" en tu iniciativa, instando a los visitantes a que se adhieran a ella con el formulario que aparecerá en la parte inferior.</p>
      <p>Una vez que tengas adherentes podrás ver y descargar la lista de datos de los mismos.</p>
    </div>
    <div class="modal-footer">
  		<button type="button" class="btn btn-link cancel" data-dismiss="modal">Cancelar</button>
      <%= link_to "Confirmar", toggle_signs_active_ong_initiative_path(ong, @initiative), class: "btn btn-info confirm" %>
  	</div>
  <% end %>

  <%= modal_window id: 'signs-deactivation-confirmation' do %>
    <div class="modal-header signHeader">
    	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    	<h5 class="modal-title signTitle"><i class="icon-pencil"></i>Desactivar Firmas</h5>
    </div>
    <div class="modal-body">
      <p>Los potenciales adherentes ya no podrán demostrar su interés por tu iniciativa.</p>
    </div>
    <div class="modal-footer">
  		<button type="button" class="btn btn-link cancel" data-dismiss="modal">Cancelar</button>
      <%= link_to "Confirmar", toggle_signs_active_ong_initiative_path(ong, @initiative), class: "btn btn-info confirm" %>
  	</div>
  <% end %>

  <%= modal_window id: 'spam-activation-confirmation' do %>
    <div class="modal-header spamHeader">
    	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    	<h5 class="modal-title spamTitle"><i class="icon-envelope"></i>Activar Comunicación con Legisladores</h5>
    </div>
    <%= simple_form_for @initiative, url: toggle_spam_active_ong_initiative_path(ong, @initiative), method: :patch, id: 'spam_activation_form' do |f| %>
      <div class="modal-body">
        <p>Invita a tus adherentes a comunicarse con sus legisladores. Para ello, especifica quiénes son los legisladores pertientes según el estado de tu iniciativa:</p>
        <div class="row">
    			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <%= f.label 'Legisladores pertinentes' %>
    			</div>
    			<div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <%= f.input :spam_active, as: :hidden, input_html: { value: true } %>
    				<div class="btn-group" data-toggle="buttons">
              <%= f.label :spam_receiver_selected, class: "btn btn-sm btn-success#{@initiative.spam_receiver_selected == :commission ? " active" : ""}" do %>
                <%= f.radio_button(:spam_receiver_selected, :commission) + "Comisión" %>
              <% end %>
              <%= f.label :spam_receiver_selected, class: "btn btn-sm btn-success#{@initiative.spam_receiver_selected == :deputies ? " active" : ""}" do %>
                <%= f.radio_button(:spam_receiver_selected, :deputies) + "Cámara" %>
              <% end %>
              <%= f.label :spam_receiver_selected, class: "btn btn-sm btn-success#{@initiative.spam_receiver_selected == :senate ? " active" : ""}" do %>
                <%= f.radio_button(:spam_receiver_selected, :senate) + "Senado" %>
              <% end %>
    				</div>
    			</div>
          <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
            <div id="select-commission">
              <%= f.input :spam_param, collection: Commission.all, prompt: 'Selecciona la comisión…', label: '¿Cuál Comisión?' %>
            </div>
          </div>
    		</div>
      </div>
      <div class="modal-footer">
    		<button type="button" class="btn btn-link cancel" data-dismiss="modal">Cancelar</button>
        <%= f.button :submit, "Confirmar", class: "btn btn-success confirm" %>
    	</div>
    <% end %>
  <% end %>

  <%= modal_window id: 'spam-deactivation-confirmation' do %>
    <div class="modal-header spamHeader">
    	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    	<h5 class="modal-title spamTitle"><i class="icon-envelope"></i>Desactivar Comunicación con Legisladores</h5>
    </div>
    <div class="modal-body">
      <p>Actualmente tienes configurado la comunicación con <strong><%= human_initiative_spam_receiver(@initiative) %></strong>.</p>
      <p>Tus adherentes no serán instados a comunicarse con sus legisladores.</p>
    </div>
    <div class="modal-footer">
  		<button type="button" class="btn btn-link cancel" data-dismiss="modal">Cancelar</button>
      <%= link_to "Confirmar", toggle_spam_active_ong_initiative_path(ong, @initiative), class: "btn btn-success confirm" %>
  	</div>
  <% end %>
<% end %>

<div class="row">
	<div class="col-md-12">
    <% if permitted_to? :update, :initiatives %>
      <div class="well editInitiative">
  			<p>
          <%= link_to("Editar iniciativa", edit_ong_initiative_path(ong, @initiative), class: "btn btn-xs btn-default pull-right") %><strong>Administrar</strong></p>
  			<hr />
  			<div class="row">
          <%= render 'active_inactive', icon_class: 'pencil', title: 'Firmas', object: @initiative, attribute: :signs_active, options: { event_name: 'form:signs-active' } %>
          <%= render 'active_inactive', icon_class: 'money', title: 'Donaciones', object: @initiative, attribute: :donations_active, options: {} %>
          <%= render 'active_inactive', icon_class: 'group', title: 'Manifestación', object: @initiative, attribute: :protest_active, options: {} %>
          <%= render 'active_inactive', icon_class: 'comments', title: 'Comunicación', object: @initiative, attribute: :spam_active, options: { event_name: 'form:spam-active' } %>
  			</div>
  		</div>
    <% end %>
    
		<h1><%= @initiative.title %>
      <span class="social-share">
        <%= link_to facebook_url(@initiative), target: "_blank", data: { "facebook-sharer" => true } do %>
          <i class="icon-facebook-sign"></i>
        <% end %>
        <%= link_to tweet_url(@initiative), target: "_blank", data: { "twitter-sharer" => true } do %>
          <i class="icon-twitter-sign"></i>
        <% end %>
      </span>
    </h1>
	</div>
</div>

<div class="row">
	<div class="col-xs-12 col-sm-6 col-md-8 col-lg-8">
    
		<div id="iniciative-description" class="textBox">
      <%= image_tag @initiative.image.url(:medium), alt: "Imagen iniciativa", class: 'thumbnail pull-left' if @initiative.image.exists? %>
			<%= @initiative.description.html_safe %>
		</div>
    <% unless permitted_to? :manage, :initiatives %>
      <% if @initiative.signs_active %>
    		<div id="signButton" class="well clearfix actionBox">
    			<a id="goto-sign-button" href="#signInitiative" class="pull-right btn btn-info">Firma</a>
    			<i class="pull-left icon-pencil"></i>
    			<p>Contigo podemos ser <strong data-signs-count="1"><%= @initiative.signs_count + 1 %></strong> adherentes</p>
    		</div>
      <% end %>
      <% if @initiative.donations_active %>
    		<div id="donateButton" class="well clearfix actionBox">
    			<span href="#" class="pull-right"><%= donation_button %></span>
    			<i class="pull-left icon-bullhorn"></i>
    			<p>Con tu ayuda podríamos llegar a más personas</p>
    		</div>
      <% end %>
      <% if @initiative.spam_active %>
        <div id="spamButton" class="well clearfix actionBox">
      		<a href="#" class="pull-right btn btn-success">Envía</a>
      		<i class="pull-left icon-envelope"></i>
      		<p>Pronto se discutirá en <%= human_initiative_spam_receiver(@initiative) %>, escríbele a tus representantes</p>
      	</div>
      <% end %>
      <% if @initiative.protest_active %>
        <div id="protestButton" class="well clearfix actionBox">
      		<a href="#" class="pull-right btn btn-danger">Envía</a>
      		<i class="pull-left icon-group"></i>
      		<p>Marcha en favor de la iniciativa</p>
      	</div>
      <% end %>
    <% end %>
		<div class="well statistics">
			<h6><i class="icon-bar-chart"></i>Estadísticas de esta iniciativa</h6>
			<hr>
			<div class="row">
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-4"><i class="icon-pencil"></i><strong data-signs-count><%= @initiative.signs_count || 0 %></strong> firmas</div>
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-4"><i class="icon-money"></i><strong><%= @initiative.donations_count || 0 %></strong> donaciones</div>
				<div class="col-xs-12 col-sm-6 col-md-4 col-lg-4"><i class="icon-eye-open"></i><strong>2000</strong> visitas</div>
			</div>
		</div>
    <% if permitted_to? :manage, :initiatives %>
      <div class="textBox">
        <%= link_to "Ver lista de Firmantes", ong_initiative_signs_path(ong, @initiative), class: "btn btn-info btn-lg btn-block" %>
  		</div>
    <% else %>
  		<% if @initiative.signs_active %>
        <div id="signInitiative" class="well">
          <%= render "signs/form", sign: Sign.new %>
        </div>
  		<% end %>
    <% end %>
	</div>

	<div class="col-xs-12 col-sm-6 col-md-4 col-lg-4">
		<div class="well">
      <h6><i class="icon-bullhorn"></i> Ayúdanos a difundur</h6>
			<strong class="hashtag lead">#<%= @initiative.hashtag %></strong>
      <%= link_to facebook_url(@initiative), target: "_blank", data: { "facebook-sharer" => true }, class: "btn btn-primary btn-block" do %>
        <i class="icon-facebook-sign"></i>Comparte en Facebook
      <% end %>
      <%= link_to tweet_url(@initiative), target: "_blank", data: { "twitter-sharer" => true }, class: "btn btn-info btn-block" do %>
        <i class="icon-twitter-sign"></i>Tuitea esta iniciativa
      <% end %>
		</div>
		<div class="textBox">
			<h6><i class="icon-external-link-sign"></i>Otras iniciativas</h6>
			<div class="list-group">
        <% @initiatives.each do |i| %>
          <%= link_to i.title, ong_initiative_path(ong, i), class: "list-group-item" %>
        <% end %>
			</div>
		</div>
	</div>

</div>